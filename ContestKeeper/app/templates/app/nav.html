{% load static %}

<!-- Mobile top bar (hidden on desktop) -->
<div class="nav-topbar">
    <a href="{% url 'home' %}" class="nav-topbar-logo">ContestKeeper</a>
    <button class="nav-hamburger" id="navHamburger" aria-label="Toggle navigation" aria-expanded="false">
        <span></span>
        <span></span>
        <span></span>
    </button>
</div>

<!-- Dim overlay (mobile/tablet only) -->
<div class="nav-overlay" id="navOverlay"></div>

<nav id="nav">
    <div class="nav-container">
        <a href="{% url 'home' %}" class="nav-logo">ContestKeeper</a>
        <div class="nav-links">
            <button data-url="{% url 'home' %}" class="nav-link" id="homeBtn">Home</button>
            <button data-url="{% url 'dashboard' %}" class="nav-link" id="dashboardBtn">Dashboard</button>
            <button data-url="#" class="nav-link" id="profileBtn">Profile</button>
            <button data-url="#" class="nav-link" id="settingsBtn">Settings</button>
            <hr class="nav-auth-divider">
            {% if user.is_authenticated %}
            <span class="nav-user">{{ user.username }}</span>
            <form method="post" action="{% url 'logout' %}" class="nav-logout-form">
                {% csrf_token %}
                <button type="submit" class="nav-link">Log out</button>
            </form>
            {% else %}
            <a href="{% url 'register' %}" class="nav-link">Register</a>
            <a href="{% url 'login' %}" class="nav-link">Log in</a>
            {% endif %}
        </div>
        <script>
            document.querySelectorAll('.nav-link[data-url]').forEach(button => {
                button.addEventListener('click', function () {
                    window.location.href = this.getAttribute('data-url');
                });
            });
        </script>
    </div>
</nav>

<link rel="stylesheet" href="{% static 'css/nav.css' %}">

<script>
    (function () {
        const hamburger = document.getElementById('navHamburger');
        const nav = document.getElementById('nav');
        const overlay = document.getElementById('navOverlay');

        function openNav() {
            nav.classList.add('nav-open');
            overlay.classList.add('visible');
            hamburger.classList.add('open');
            hamburger.setAttribute('aria-expanded', 'true');
            document.body.style.overflow = 'hidden';
        }

        function closeNav() {
            nav.classList.remove('nav-open');
            overlay.classList.remove('visible');
            hamburger.classList.remove('open');
            hamburger.setAttribute('aria-expanded', 'false');
            document.body.style.overflow = '';
        }

        hamburger.addEventListener('click', function () {
            nav.classList.contains('nav-open') ? closeNav() : openNav();
        });

        overlay.addEventListener('click', closeNav);

        // Close on Escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') closeNav();
        });
    })();
</script>